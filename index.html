<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>FAQ Bot â€” Centro Master</title>
<meta name="color-scheme" content="light dark">
<style>
  /* ========= Variables y tema ========= */
  :root{
    --accent:#0b5fff;
    --bg:#f6f7fb;
    --card:#ffffff;
    --text:#1f2430;
    --muted:#6b7280;
    --ring: 0 0 0 3px rgba(11,95,255,.25);
    --radius:14px;
    --shadow:0 8px 30px rgba(0,0,0,.06);
  }
  @media (prefers-color-scheme: dark){
    :root{
      --bg:#0f1217;
      --card:#151a22;
      --text:#eef1f7;
      --muted:#a5adba;
      --shadow:0 8px 30px rgba(0,0,0,.35);
    }
  }

  /* ========= Layout base ========= */
  html,body{height:100%}
  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, Helvetica, sans-serif;
    color:var(--text);
    background:
      radial-gradient(1200px 600px at 100% -10%, rgba(11,95,255,.06), transparent 60%),
      radial-gradient(900px 500px at -10% 110%, rgba(11,95,255,.05), transparent 60%),
      var(--bg);
  }
  .wrap{max-width:960px;margin:28px auto;padding:16px}
  .header{
    display:flex;align-items:center;gap:14px;margin-bottom:14px;
    padding:14px 12px;border-radius:var(--radius);
  }
  .brand{
    width:44px;height:44px;border-radius:12px;
    display:grid;place-items:center;
    background: linear-gradient(135deg, var(--accent), #7aa7ff);
    color:#fff;font-weight:800;font-size:22px;box-shadow:var(--shadow);
  }
  .titleBox h1{margin:0;font-size:28px;line-height:1.1}
  .titleBox .sub{margin:6px 0 0;color:var(--muted);font-size:14px}
  .underline{height:4px;width:86px;border-radius:99px;background:var(--accent);margin-top:10px}

  /* ========= Card del chat ========= */
  .chat{
    background:var(--card);border-radius:20px;padding:14px;box-shadow:var(--shadow);
    border:1px solid rgba(0,0,0,.06);
  }
  .controls{
    display:flex;gap:10px;align-items:center;margin-bottom:12px;flex-wrap:wrap
  }
  .search{
    flex:1;min-width:220px;padding:12px 14px;border-radius:999px;border:1px solid rgba(0,0,0,.12);
    background:transparent;color:var(--text);outline:none;
  }
  .search:focus{box-shadow:var(--ring);border-color:transparent}
  .btn{
    border:none;background:var(--accent);color:#fff;border-radius:999px;padding:12px 16px;
    cursor:pointer;font-weight:600;display:inline-flex;align-items:center;gap:8px
  }
  .btn:focus{outline:none;box-shadow:var(--ring)}
  .btn:active{transform:translateY(1px)}

  .messages{
    max-height:480px;overflow:auto;padding:6px 4px;display:flex;flex-direction:column;gap:10px;
    scroll-behavior:smooth;
  }
  .row{display:flex;gap:10px;align-items:flex-end}
  .row.user{justify-content:flex-end}
  .row.bot{justify-content:flex-start}

  .avatar{
    width:32px;height:32px;border-radius:50%;flex:0 0 32px;display:grid;place-items:center;
    background: #eef3ff;color:#27439b;font-weight:800;border:1px solid rgba(0,0,0,.06)
  }
  @media (prefers-color-scheme: dark){
    .avatar{background:#1c2430;color:#9eb4ff;border-color:#1f2835}
  }
  .bubble{
    max-width:78%;padding:12px 14px;border-radius:16px;line-height:1.45;font-size:15px
  }
  .bubble.user{
    background:var(--accent);color:#fff;border-top-right-radius:6px;
  }
  .bubble.bot{
    background:#eef3ff;border-top-left-radius:6px;color:#1e2433;border:1px solid rgba(0,0,0,.06)
  }
  @media (prefers-color-scheme: dark){
    .bubble.bot{background:#1b2433;color:#e9eef9;border-color:#1f2a3a}
  }

  .suggestions{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0 0}
  .chip{
    background:#eef3ff;border:1px solid rgba(11,95,255,.15);color:#1e2a55;
    padding:8px 12px;border-radius:999px;cursor:pointer;font-size:13px
  }
  @media (prefers-color-scheme: dark){
    .chip{background:#1b2433;color:#dfe7ff;border-color:#1f2a3a}
  }
  .chip:focus{outline:none;box-shadow:var(--ring)}
  .chip:hover{filter:brightness(.98)}

  .small{font-size:13px;color:var(--muted);margin-top:8px}
  .footer{margin-top:12px;font-size:12.5px;color:var(--muted)}

  /* ========= Enlaces en respuestas ========= */
  .bubble a{color:var(--accent);text-decoration:none}
  .bubble a:hover{text-decoration:underline}

  /* ========= Escribiendo... ========= */
  .typing{display:inline-flex;gap:4px;align-items:center}
  .dot{width:6px;height:6px;border-radius:50%;background:#8aa3ff;opacity:.6;animation:bounce 1.2s infinite}
  .dot:nth-child(2){animation-delay:.15s}
  .dot:nth-child(3){animation-delay:.3s}
  @keyframes bounce{
    0%,80%,100%{transform:translateY(0);opacity:.5}
    40%{transform:translateY(-4px);opacity:1}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="header" role="banner" aria-label="Cabecera FAQ">
      <div class="brand" aria-hidden="true">CM</div>
      <div class="titleBox">
        <h1>Preguntas Frecuentes â€” Chat</h1>
        <div class="sub">Pregunta y te respondemos con la mejor coincidencia (IT, RRHH, FormaciÃ³n, AdministraciÃ³n).</div>
        <div class="underline" aria-hidden="true"></div>
      </div>
    </div>

    <div class="chat" role="application" aria-label="Chat FAQ">
      <div class="controls">
        <input id="q" class="search" type="search" placeholder="Escribe tu preguntaâ€¦ (p. ej. Â«Â¿CÃ³mo cambio mi contraseÃ±a?Â»)" aria-label="Escribe tu pregunta"/>
        <button id="ask" class="btn" aria-label="Preguntar">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 3L10 14" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M21 3L14.5 21L10 14L3 9L21 3Z" stroke="white" stroke-width="2" stroke-linejoin="round"/></svg>
          Preguntar
        </button>
      </div>

      <div class="messages" id="messages" aria-live="polite"></div>

      <div class="small">Sugerencias rÃ¡pidas:</div>
      <div class="suggestions" id="suggestions"></div>
      <div class="footer">Fuente: JSON estÃ¡tico (sin IA). Actualiza las Q/A editando tu repositorio.</div>
    </div>
  </div>

<script>
/* ========= JSON de FAQ: edita aquÃ­ o carga faq.json con fetch ========= */
const FAQ = [
  {"Title":"Â¿CÃ³mo cambio mi contraseÃ±a?","Answer":"Ve a Microsoft 365 > Mi cuenta > Seguridad > Restablecer contraseÃ±a.\nSi tienes MFA, aprueba en Authenticator.","Category":"IT"},
  {"Title":"No me llega el cÃ³digo MFA, Â¿quÃ© hago?","Answer":"Abre Microsoft Authenticator y sincroniza.\nSi sigue sin funcionar, abre un ticket: Intranet > Incidencias IT.","Category":"IT"},
  {"Title":"Â¿CÃ³mo conecto OneDrive en mi PC?","Answer":"Abre la app OneDrive, inicia sesiÃ³n con tu cuenta corporativa y elige la carpeta â€œCentro Masterâ€.","Category":"IT"},
  {"Title":"Â¿CÃ³mo solicito vacaciones?","Answer":"Intranet > RRHH > Vacaciones > Nueva solicitud.\nRecibirÃ¡s confirmaciÃ³n por correo.","Category":"RRHH"},
  {"Title":"Â¿DÃ³nde consulto mi nÃ³mina?","Answer":"Intranet > RRHH > Documentos personales > NÃ³minas.","Category":"RRHH"},
  {"Title":"Â¿CÃ³mo pido un justificante laboral?","Answer":"En RRHH > Solicitudes > Nuevo > Justificante.","Category":"RRHH"},
  {"Title":"Â¿DÃ³nde veo los cursos activos?","Answer":"Intranet > Departamento de Cursos > Cursos activos.","Category":"FormaciÃ³n"},
  {"Title":"Â¿DÃ³nde encuentro los manuales de formaciÃ³n?","Answer":"Intranet > Biblioteca â€œFormaciÃ³nâ€ > Carpeta Manuales.","Category":"FormaciÃ³n"},
  {"Title":"Â¿CÃ³mo abro un ticket de soporte general?","Answer":"Intranet > Incidencias > Nuevo.\nRecibirÃ¡s nÃºmero de seguimiento por correo.","Category":"AdministraciÃ³n"},
  {"Title":"Â¿CÃ³mo solicito material de oficina?","Answer":"Intranet > AdministraciÃ³n > Solicitudes > Nuevo.","Category":"AdministraciÃ³n"}
];

/* ========= Utilidades de matching ========= */
function tokenize(s){
  return (s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'')
    .replace(/[^\w\s]/g,' ').split(/\s+/).filter(Boolean);
}
function scoreQuery(query, item){
  const qTokens = tokenize(query);
  const tTokens = tokenize(item.Title);
  const aTokens = tokenize(item.Answer);
  const tSet = new Set(tTokens);
  const aSet = new Set(aTokens);
  let score = 0;
  qTokens.forEach(tok=>{
    if(tSet.has(tok)) score += 3;
    else if(aSet.has(tok)) score += 1;
    // prefijo aproximado en tÃ­tulo
    tTokens.forEach(tt=>{ if(tt.startsWith(tok)) score += 2; });
  });
  const q = query.toLowerCase();
  if((item.Title || '').toLowerCase().includes(q)) score += 6;
  if((item.Answer || '').toLowerCase().includes(q)) score += 2;
  return score;
}
function findBestMatches(query, maxResults=4){
  if(!query || !query.trim()) return [];
  const scored = FAQ.map(it=>({it, sc: scoreQuery(query, it)})).sort((a,b)=>b.sc-a.sc);
  return scored.filter(s=>s.sc>0).slice(0,maxResults).map(s=>s.it);
}

/* ========= UI ========= */
const messages = document.getElementById('messages');
const suggestions = document.getElementById('suggestions');
const qinput = document.getElementById('q');
const askBtn = document.getElementById('ask');

function addRow(html, who='bot'){
  const row = document.createElement('div');
  row.className = 'row ' + (who==='user'?'user':'bot');

  const avatar = document.createElement('div');
  avatar.className = 'avatar';
  avatar.textContent = who==='user' ? 'TÃº' : 'CM';

  const bubble = document.createElement('div');
  bubble.className = 'bubble ' + (who==='user'?'user':'bot');
  bubble.innerHTML = html.replace(/\n/g,'<br>');

  if(who==='user'){ row.appendChild(bubble); row.appendChild(avatar); }
  else { row.appendChild(avatar); row.appendChild(bubble); }

  messages.appendChild(row);
  messages.scrollTop = messages.scrollHeight;
}
function typingOn(){
  const row = document.createElement('div');
  row.className = 'row bot'; row.id = 'typing';
  row.innerHTML = `
    <div class="avatar">CM</div>
    <div class="bubble bot"><span class="typing">
      <span class="dot"></span><span class="dot"></span><span class="dot"></span>
    </span></div>`;
  messages.appendChild(row);
  messages.scrollTop = messages.scrollHeight;
}
function typingOff(){
  const t = document.getElementById('typing');
  if(t) t.remove();
}

function showSuggestions(){
  suggestions.innerHTML = '';
  const tops = [
    "Â¿CÃ³mo cambio mi contraseÃ±a?",
    "Solicitar vacaciones",
    "Manual de OneDrive",
    "Abrir ticket IT",
    "Ver nÃ³mina"
  ];
  tops.forEach(text=>{
    const b = document.createElement('button');
    b.className='chip'; b.textContent=text; b.setAttribute('aria-label', 'Sugerencia: ' + text);
    b.onclick=()=>{ qinput.value = text; ask(); };
    suggestions.appendChild(b);
  });
}

/* ========= Flujo ========= */
function ask(){
  const q = (qinput.value||'').trim();
  if(!q) return;
  addRow(q, 'user');
  qinput.value = '';
  typingOn();

  // Simular breve "pensando"
  setTimeout(()=>{
    const matches = findBestMatches(q, 5);
    typingOff();

    if(matches.length===0){
      addRow('No he encontrado una respuesta exacta. Prueba reformular la pregunta o consulta la secciÃ³n de RRHH/IT en la intranet.');
      const sample = FAQ.slice(0,4).map(i=>`â€¢ <strong>${i.Title}</strong>`).join('<br>');
      addRow('<b>Preguntas relacionadas:</b><br>' + sample);
      return;
    }

    const best = matches[0];
    let html = `<div style="font-weight:700;margin-bottom:6px">${best.Title}</div>`;
    html += `<div>${best.Answer.replace(/\n/g,'<br>')}</div>`;
    if(best.Category){
      html += `<div style="margin-top:8px;display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid rgba(11,95,255,.18);color:var(--accent)">${best.Category}</div>`;
    }
    addRow(html);

    if(matches.length>1){
      const more = matches.slice(1).map(m=>`<div style="margin-top:8px">ðŸ”¹ <b>${m.Title}</b><br><span style="opacity:.85">${(m.Answer||'').split('\n')[0]}</span></div>`).join('');
      addRow('<b>TambiÃ©n puede ayudarte:</b><br>' + more);
    }
  }, 350);
}

/* ========= Accesibilidad / UX ========= */
askBtn.addEventListener('click', ask);
qinput.addEventListener('keydown', (e)=>{ if(e.key==='Enter') ask(); });

/* inicio */
showSuggestions();
addRow('Â¡Hola! ðŸ‘‹ Puedo ayudarte con dudas sobre IT, RRHH, FormaciÃ³n y AdministraciÃ³n. Escribe tu pregunta o elige una sugerencia.');
</script>
</body>
</html>








